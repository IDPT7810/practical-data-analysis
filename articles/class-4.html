<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class 4: RNA-seq Analysis part 1 • pbda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Class 4: RNA-seq Analysis part 1">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pbda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Class Material
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/class-1.html">Class 1: Overview, Data Import and Tidying</a>
    </li>
    <li>
      <a href="../articles/class-2.html">Class 2: Analyzing qPCR data</a>
    </li>
    <li>
      <a href="../articles/class-3.html">Class 3: Exploring a biological data set</a>
    </li>
    <li>
      <a href="../articles/class-4.html">Class 4: RNA-seq Analysis</a>
    </li>
    <li>
      <a href="../articles/class-5.html">Class 5: Gene List Handling</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/assignments.html">Assignment Submission and Grading Rubric</a>
    </li>
    <li>
      <a href="../articles/problem-set-1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="../articles/problem-set-2.html">Problem Set 2</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Class 4: RNA-seq Analysis part 1</h1>
                        <h4 class="author">Austin Gillen</h4>
            
            <h4 class="date">2018-12-07</h4>
      
      
      <div class="hidden name"><code>class-4.Rmd</code></div>

    </div>

    
    
<div id="rna-seq-analysis-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#rna-seq-analysis-in-r" class="anchor"></a>RNA-seq analysis in R</h1>
<ul>
<li>Introduce matrices and matrix manipulation in R</li>
<li>Build a DESeqDataSet and calculate differential gene expression</li>
<li>Plot results and QC metrics</li>
</ul>
<div id="before-we-get-started-install-bioconductor-packages-and-update-pbda" class="section level2">
<h2 class="hasAnchor">
<a href="#before-we-get-started-install-bioconductor-packages-and-update-pbda" class="anchor"></a>Before we get started: Install Bioconductor packages and update pbda</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"BiocManager"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">BiocManager<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/BiocManager/topics/install">install</a></span>(<span class="st">"DESeq2"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">BiocManager<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/BiocManager/topics/install">install</a></span>(<span class="st">"ComplexHeatmap"</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">'idpt7810/practical-data-analysis'</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(pbda)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(DESeq2)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ComplexHeatmap)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(RColorBrewer)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(cowplot)</a></code></pre></div>
</div>
<div id="matrices-in-r-are-two-dimensional-objects-that-contain-elements-of-one-atomic-type" class="section level2">
<h2 class="hasAnchor">
<a href="#matrices-in-r-are-two-dimensional-objects-that-contain-elements-of-one-atomic-type" class="anchor"></a>Matrices in R are two dimensional objects that contain elements of one atomic type</h2>
<p>Matrices can contain characters or logical values, but we’re really only interested in numeric matrices:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Build 4x3 matrix with row-wise series of integers</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">M &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">            <span class="dt">nrow =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">            <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">M</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; [1,]    1    2    3</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; [2,]    4    5    6</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; [3,]    7    8    9</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; [4,]   10   11   12</span></a></code></pre></div>
</div>
<div id="elements-of-a-matrix-can-be-accessed-using-column-and-row-indices-or-names" class="section level2">
<h2 class="hasAnchor">
<a href="#elements-of-a-matrix-can-be-accessed-using-column-and-row-indices-or-names" class="anchor"></a>Elements of a matrix can be accessed using column and row indices or names</h2>
<p>To return the value in the first row, second column:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">M[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>With named rows and columns:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Assign column names</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(M) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"col1"</span>,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">            <span class="st">"col2"</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">            <span class="st">"col3"</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># Assign row names</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/row.names">row.names</a></span>(M) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"row1"</span>,</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">            <span class="st">"row2"</span>,</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">            <span class="st">"row3"</span>,</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">            <span class="st">"row4"</span>)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">M[<span class="st">"row1"</span>,<span class="st">"col2"</span>]</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>Index ranges and character vectors of row/column names also work:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">M[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt;      col2 col3</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; row1    2    3</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; row2    5    6</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">M[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"row1"</span>,<span class="st">"row2"</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"col2"</span>,<span class="st">"col3"</span>)]</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;      col2 col3</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; row1    2    3</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; row2    5    6</span></a></code></pre></div>
<p>As does negative selection:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Exclude rows 1 and 4</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">M[<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">4</span>),]</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt;      col1 col2 col3</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; row2    4    5    6</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; row3    7    8    9</span></a></code></pre></div>
<p>Full rows and columns can be extracted as well:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># print 1st row</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">M[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; col1 col2 col3 </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;    1    2    3</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co"># print 2nd column</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">M[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; row1 row2 row3 row4 </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;    2    5    8   11</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co"># print 2nd and 3rd rows</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">M[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>,]</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;      col1 col2 col3</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; row2    4    5    6</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; row3    7    8    9</span></a></code></pre></div>
</div>
<div id="mathematical-operations-can-be-performed-on-numeric-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#mathematical-operations-can-be-performed-on-numeric-matrices" class="anchor"></a>Mathematical operations can be performed on numeric matrices</h2>
<p>For example, taking the base 2 logarithm of each value:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">M_log &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log2</a></span>(M)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">M_log</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;          col1     col2     col3</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; row1 0.000000 1.000000 1.584963</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; row2 2.000000 2.321928 2.584963</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; row3 2.807355 3.000000 3.169925</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; row4 3.321928 3.459432 3.584963</span></a></code></pre></div>
<p>Or normalizing all columns relative to an arbitrary reference column:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">M_norm &lt;-<span class="st"> </span>M<span class="op">/</span>M[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">M_norm</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;      col1     col2     col3</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; row1    1 2.000000 3.000000</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; row2    1 1.250000 1.500000</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; row3    1 1.142857 1.285714</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; row4    1 1.100000 1.200000</span></a></code></pre></div>
<div id="matrix-exercises" class="section level3">
<h3 class="hasAnchor">
<a href="#matrix-exercises" class="anchor"></a>Matrix Exercises</h3>
<ul>
<li>Build a 100x100 row-wise matrix of sequential integers named <code>mat</code>.</li>
<li>Create a new matrix, <code>mat_sub</code>, with columns 2-10 and rows 40-60 from the <code>mat</code>.</li>
<li>Calculate the maximum and minimum values present in <code>mat_sub</code>.</li>
<li>Using the <code><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowMeans()</a></code> function, subtract the row-wise mean from each value in <code>mat_sub</code>.</li>
</ul>
</div>
</div>
</div>
<div id="analyzing-rna-seq-data" class="section level1">
<h1 class="hasAnchor">
<a href="#analyzing-rna-seq-data" class="anchor"></a>Analyzing RNA-Seq Data</h1>
<div id="simplified-rna-sequencing-analysis-workflow-genome-alignment" class="section level2">
<h2 class="hasAnchor">
<a href="#simplified-rna-sequencing-analysis-workflow-genome-alignment" class="anchor"></a>Simplified RNA sequencing analysis workflow (genome alignment)</h2>
<table class="table">
<colgroup>
<col width="29%">
<col width="21%">
<col width="48%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Tools</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Align reads to genome</td>
<td>STAR, HISAT2</td>
<td>Align reads to genomic sequence, retaining strand information if present</td>
</tr>
<tr class="even">
<td>Assign reads to features</td>
<td>Subread, StringTie</td>
<td>Assign aligned reads to genes and/or transcripts</td>
</tr>
<tr class="odd">
<td>Calculate differential expression</td>
<td>DESeq2, edgeR, Ballgown</td>
<td>Fit count matrices to model to determine differential expression</td>
</tr>
</tbody>
</table>
</div>
<div id="simplified-rna-sequencing-analysis-workflow-quasi-mapping" class="section level2">
<h2 class="hasAnchor">
<a href="#simplified-rna-sequencing-analysis-workflow-quasi-mapping" class="anchor"></a>Simplified RNA sequencing analysis workflow (quasi-mapping)</h2>
<table class="table">
<colgroup>
<col width="29%">
<col width="21%">
<col width="48%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Tools</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Estimate transcript abundance</td>
<td>Salmon / Kallisto</td>
<td>Estimate transcript abundance directly on transcriptome sequences</td>
</tr>
<tr class="even">
<td>Calculate differential expression</td>
<td>DESeq2, edgeR, Ballgown</td>
<td>Fit count matrices to model to determine differential expression</td>
</tr>
</tbody>
</table>
</div>
<div id="inspect-rna-seq-count-and-phenotype-data-from-file-that-is-included-in-pbda-package" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-rna-seq-count-and-phenotype-data-from-file-that-is-included-in-pbda-package" class="anchor"></a>Inspect RNA-seq count and phenotype data from file that is included in pbda package</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># View first few rows of count matrix</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(drug_resistant_counts)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;           parent1 parent2 parent3 A_resistant1 A_resistant2 A_resistant3</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; DDX11L1         0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; WASH7P          3       7      13            7           12            9</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; MIR6859-1       1       1       1            2            1            2</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; MIR1302-2       0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; FAM138A         0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; OR4F5           0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;           B_resistant1 B_resistant2 B_resistant3 C_resistant1 C_resistant2</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; DDX11L1              0            0            0            0            0</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; WASH7P              10            9           11           24            7</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; MIR6859-1            2            2            2            6            0</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; MIR1302-2            0            0            0            0            0</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; FAM138A              0            0            0            0            0</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; OR4F5                0            0            0            0            0</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt;           C_resistant3</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; DDX11L1              0</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; WASH7P               9</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; MIR6859-1            1</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt; MIR1302-2            0</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="co">#&gt; FAM138A              0</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#&gt; OR4F5                0</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co"># View phenotype data</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26">drug_resistant_coldata</a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#&gt;              drug</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="co">#&gt; parent1      none</span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="co">#&gt; parent2      none</span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co">#&gt; parent3      none</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="co">#&gt; A_resistant1    A</span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="co">#&gt; A_resistant2    A</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="co">#&gt; A_resistant3    A</span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="co">#&gt; B_resistant1    B</span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="co">#&gt; B_resistant2    B</span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="co">#&gt; B_resistant3    B</span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="co">#&gt; C_resistant1    C</span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="co">#&gt; C_resistant2    C</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="co">#&gt; C_resistant3    C</span></a></code></pre></div>
</div>
<div id="deseq2-uses-deseqdatasets-a-subset-of-the-bioconductor-summarizedexperiment-object-to-store-data" class="section level2">
<h2 class="hasAnchor">
<a href="#deseq2-uses-deseqdatasets-a-subset-of-the-bioconductor-summarizedexperiment-object-to-store-data" class="anchor"></a>DESeq2 uses DESeqDataSets, a subset of the Bioconductor SummarizedExperiment object, to store data</h2>
<p>SummarizedExperiment objects provide a structured, self-contained way to store phenotype, gene and assay data, along with analysis intermediates and parameters.</p>
<p><img src="img/class-4-se.png"></p>
</div>
<div id="build-a-deseqdataset-from-the-drug_resistant-data-and-inspect-the-object" class="section level2">
<h2 class="hasAnchor">
<a href="#build-a-deseqdataset-from-the-drug_resistant-data-and-inspect-the-object" class="anchor"></a>Build a DESeqDataSet from the drug_resistant data and inspect the object</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Create DESeqDataSet from drug_resistant data</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">dds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(<span class="dt">countData =</span> drug_resistant_counts,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">                                         <span class="dt">colData =</span> drug_resistant_coldata,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">                                         <span class="dt">design =</span> <span class="op">~</span>drug)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co"># View DESeqDataSet</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">dds</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; class: DESeqDataSet </span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; dim: 33121 12 </span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; metadata(1): version</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; assays(1): counts</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; rownames(33121): DDX11L1 WASH7P ... VAMP7-2 IL9R-2</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; rowData names(0):</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; colnames(12): parent1 parent2 ... C_resistant2 C_resistant3</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; colData names(1): drug</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co"># View design</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">dds<span class="op">@</span>design</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; ~drug</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co"># View colData</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="kw">colData</span>(dds)</a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; DataFrame with 12 rows and 1 column</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt;                  drug</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt;              &lt;factor&gt;</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt; parent1          none</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt; parent2          none</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt; parent3          none</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt; A_resistant1        A</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt; A_resistant2        A</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt; ...               ...</span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt; B_resistant2        B</span></a>
<a class="sourceLine" id="cb11-32" data-line-number="32"><span class="co">#&gt; B_resistant3        B</span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt; C_resistant1        C</span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co">#&gt; C_resistant2        C</span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">#&gt; C_resistant3        C</span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="co"># View counts</span></a>
<a class="sourceLine" id="cb11-38" data-line-number="38"><span class="kw">assay</span>(dds) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>()</a>
<a class="sourceLine" id="cb11-39" data-line-number="39"><span class="co">#&gt;           parent1 parent2 parent3 A_resistant1 A_resistant2 A_resistant3</span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40"><span class="co">#&gt; DDX11L1         0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb11-41" data-line-number="41"><span class="co">#&gt; WASH7P          3       7      13            7           12            9</span></a>
<a class="sourceLine" id="cb11-42" data-line-number="42"><span class="co">#&gt; MIR6859-1       1       1       1            2            1            2</span></a>
<a class="sourceLine" id="cb11-43" data-line-number="43"><span class="co">#&gt; MIR1302-2       0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb11-44" data-line-number="44"><span class="co">#&gt; FAM138A         0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb11-45" data-line-number="45"><span class="co">#&gt; OR4F5           0       0       0            0            0            0</span></a>
<a class="sourceLine" id="cb11-46" data-line-number="46"><span class="co">#&gt;           B_resistant1 B_resistant2 B_resistant3 C_resistant1 C_resistant2</span></a>
<a class="sourceLine" id="cb11-47" data-line-number="47"><span class="co">#&gt; DDX11L1              0            0            0            0            0</span></a>
<a class="sourceLine" id="cb11-48" data-line-number="48"><span class="co">#&gt; WASH7P              10            9           11           24            7</span></a>
<a class="sourceLine" id="cb11-49" data-line-number="49"><span class="co">#&gt; MIR6859-1            2            2            2            6            0</span></a>
<a class="sourceLine" id="cb11-50" data-line-number="50"><span class="co">#&gt; MIR1302-2            0            0            0            0            0</span></a>
<a class="sourceLine" id="cb11-51" data-line-number="51"><span class="co">#&gt; FAM138A              0            0            0            0            0</span></a>
<a class="sourceLine" id="cb11-52" data-line-number="52"><span class="co">#&gt; OR4F5                0            0            0            0            0</span></a>
<a class="sourceLine" id="cb11-53" data-line-number="53"><span class="co">#&gt;           C_resistant3</span></a>
<a class="sourceLine" id="cb11-54" data-line-number="54"><span class="co">#&gt; DDX11L1              0</span></a>
<a class="sourceLine" id="cb11-55" data-line-number="55"><span class="co">#&gt; WASH7P               9</span></a>
<a class="sourceLine" id="cb11-56" data-line-number="56"><span class="co">#&gt; MIR6859-1            1</span></a>
<a class="sourceLine" id="cb11-57" data-line-number="57"><span class="co">#&gt; MIR1302-2            0</span></a>
<a class="sourceLine" id="cb11-58" data-line-number="58"><span class="co">#&gt; FAM138A              0</span></a>
<a class="sourceLine" id="cb11-59" data-line-number="59"><span class="co">#&gt; OR4F5                0</span></a></code></pre></div>
</div>
<div id="filter-genes-with-little-or-no-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#filter-genes-with-little-or-no-expression" class="anchor"></a>Filter genes with little or no expression</h2>
<p>DESeq2 performs internal filtering to remove genes with low expression, but explicitly filtering extreme cases beforehand can speed up processing.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># number of genes before filtering</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dds)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; [1] 33121</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co"># remove genes with 0-1 total reads</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6">dds &lt;-<span class="st"> </span>dds[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/counts">counts</a></span>(dds)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co"># number of genes after filtering</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dds)</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; [1] 21178</span></a></code></pre></div>
<div id="count-matrix-manipulation-exercises" class="section level3">
<h3 class="hasAnchor">
<a href="#count-matrix-manipulation-exercises" class="anchor"></a>Count matrix manipulation exercises</h3>
<ul>
<li>Print the counts for the genes ESR1, TFF1 and PGR from the count matrix in dds.</li>
<li>Filter genes with fewer than 5 counts in at least 3 samples.</li>
</ul>
</div>
</div>
<div id="stabilize-the-variance-across-the-mean-for-visualizing-count-data" class="section level2">
<h2 class="hasAnchor">
<a href="#stabilize-the-variance-across-the-mean-for-visualizing-count-data" class="anchor"></a>Stabilize the variance across the mean for visualizing count data</h2>
<p>Many analysis methods for multidimensional data rely on variance being consistent across mean values. Raw count data has the greatest variance at high mean values (largest raw values), while log2-transformed data has the greatest variance at low mean values (largest fold-changes). To get around this, DESeq2 provides two different functions - <code><a href="https://www.rdocumentation.org/packages/DESeq2/topics/vst">vst()</a></code> and <code><a href="https://www.rdocumentation.org/packages/DESeq2/topics/rlog">rlog()</a></code> - that stabilize variance across the mean.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># rlog transform</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">rld &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/rlog">rlog</a></span>(dds,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">            <span class="dt">blind =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="sample-distances-are-useful-to-assess-the-overall-similarity-between-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-distances-are-useful-to-assess-the-overall-similarity-between-samples" class="anchor"></a>Sample distances are useful to assess the overall similarity between samples</h2>
<p>Sample distance plots are used to assess overall similarity between samples: which samples are similar to each other, which are different? We calculate the euclidean distance between samples using <code><a href="https://www.rdocumentation.org/packages/stats/topics/dist">dist()</a></code> on the rlog-transformed data to ensure roughly equal contributions from all genes.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># Transpose count matrix and calculate distances using dist()</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">sampleDists &lt;-<span class="st"> </span><span class="kw">assay</span>(rld) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/dist">dist</a></span>()</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co"># Convert distance dataframe to matrix</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">sampleDistMatrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(sampleDists)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co"># Choose continuous palette from RColorBrewer</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8">colors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/colorRamp">colorRampPalette</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rev">rev</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/RColorBrewer/topics/ColorBrewer">brewer.pal</a></span>(<span class="dv">9</span>, <span class="st">"Blues"</span>)))(<span class="dv">255</span>)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co"># Plot sample distance heatmap with ComplexHeatmap</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/ComplexHeatmap/topics/Heatmap">Heatmap</a></span>(sampleDistMatrix, <span class="dt">cluster_rows =</span> F, <span class="dt">cluster_columns =</span> F,</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">         <span class="dt">col =</span> colors)</a></code></pre></div>
<p><img src="class-4_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="principle-component-analysis-pca-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#principle-component-analysis-pca-plots" class="anchor"></a>Principle Component Analysis (PCA) plots</h2>
<p>Another method for visualizing relationships in multidimensional data is principle component analysis. PCA identifies clusters of variables (in this case, genes) that explain the majority of the variance present. PCA plots are x-y plots of the first two principle components; they spread the samples out in the two directions that explain most of the differences.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># Generate PCA plot with DESeq2 plotPCA() wrapper</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/plotPCA">plotPCA</a></span>(rld, <span class="dt">intgroup =</span> <span class="st">"drug"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">"Set1"</span>)</a></code></pre></div>
<p><img src="class-4_files/figure-html/pca-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="calculating-differential-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-differential-expression" class="anchor"></a>Calculating differential expression</h2>
<p>DESeq2 provides a wrapper function <code><a href="https://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq()</a></code> that takes a DESeqDataSet and calculates differential expression. Progress through analysis steps are printed as the function runs.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># Run DESeq2</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">dds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt; estimating size factors</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt; estimating dispersions</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt; gene-wise dispersion estimates</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; mean-dispersion relationship</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt; final dispersion estimates</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; fitting model and testing</span></a></code></pre></div>
</div>
<div id="extracting-results-after-differential-expression-is-calculated" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-results-after-differential-expression-is-calculated" class="anchor"></a>Extracting results after differential expression is calculated</h2>
<p>DESeq2 results are extracted with the <code><a href="https://www.rdocumentation.org/packages/DESeq2/topics/results">results()</a></code> function.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># Extract default results (No Drug vs. Drug A)</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">res &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/results">results</a></span>(dds)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co"># View results summary</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/summary">summary</a></span>(res)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt; out of 21178 with nonzero total read count</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; adjusted p-value &lt; 0.1</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt; LFC &gt; 0 (up)       : 3165, 15%</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt; LFC &lt; 0 (down)     : 3337, 16%</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt; outliers [1]       : 25, 0.12%</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; low counts [2]     : 3696, 17%</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt; (mean count &lt; 2)</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt; [1] see 'cooksCutoff' argument of ?results</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt; [2] see 'independentFiltering' argument of ?results</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="co"># Convert dataframe to tibble for use with tidyverse tools</span></a>
<a class="sourceLine" id="cb17-18" data-line-number="18">res_tibble &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(res) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="st">  </span>tibble<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tibble/topics/rownames">rownames_to_column</a></span>(<span class="dt">var =</span> <span class="st">"gene"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"><span class="st">  </span><span class="kw">as.tibble</span>()</a></code></pre></div>
</div>
<div id="ma-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#ma-plots" class="anchor"></a>MA-plots</h2>
<p>MA plots - plots of mean expression (x-axis) vs. log2-fold change (y-axis) - are useful for visualizing the distribution of gene expression in your comparisons.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co"># Plot MA without moderating log2 fold-changes</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/plotMA">plotMA</a></span>(res, <span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">6</span>,<span class="dv">6</span>))</a></code></pre></div>
<p><img src="class-4_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co"># Return results with moderated log2 fold-changes.</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">res_ma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/lfcShrink">lfcShrink</a></span>(dds, <span class="dt">contrast=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"drug"</span>,<span class="st">"none"</span>,<span class="st">"A"</span>), <span class="dt">res=</span>res)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt; using 'normal' for LFC shrinkage, the Normal prior from Love et al (2014).</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; additional priors are available via the 'type' argument, see ?lfcShrink for details</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co"># Plot MA</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/plotMA">plotMA</a></span>(res_ma, <span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">6</span>,<span class="dv">6</span>))</a></code></pre></div>
<p><img src="class-4_files/figure-html/unnamed-chunk-7-2.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-differential-expression-results" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-differential-expression-results" class="anchor"></a>Plotting differential expression results</h2>
<p>DESeq2 can plot normalized counts using the <code><a href="https://www.rdocumentation.org/packages/DESeq2/topics/plotCounts">plotCounts()</a></code> function.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Plot differential expression</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/plotCounts">plotCounts</a></span>(dds,</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">           <span class="dt">gene =</span> <span class="st">"ESR1"</span>,</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">           <span class="dt">intgroup=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"drug"</span>))</a></code></pre></div>
<p><img src="class-4_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co"># Clean up plot with ggplot2</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">dds_plot &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/plotCounts">plotCounts</a></span>(dds,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">           <span class="dt">gene =</span> <span class="st">"ESR1"</span>,</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">           <span class="dt">intgroup=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"drug"</span>),</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">           <span class="dt">returnData =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="kw">ggplot</span>(dds_plot, <span class="kw">aes</span>(<span class="dt">x =</span> drug, <span class="dt">y =</span> count, <span class="dt">color =</span> drug)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="class-4_files/figure-html/unnamed-chunk-8-2.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-heatmaps-of-differentially-expressed-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-heatmaps-of-differentially-expressed-genes" class="anchor"></a>Plotting heatmaps of differentially expressed genes</h2>
<p>The ComplexHeatmap package can be used to plot differential gene expression across samples/replicates.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># extract the 20 most significantly differentially expressed genes</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">top_genes &lt;-<span class="st"> </span>res_tibble <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(padj) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co"># subset rlog matrix based on gene list</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5">mat  &lt;-<span class="st"> </span><span class="kw">assay</span>(rld)[ top_genes<span class="op">$</span>gene, ]</a>
<a class="sourceLine" id="cb22-6" data-line-number="6"></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co"># normalize expression to per-gene average</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8">mat  &lt;-<span class="st"> </span>mat <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowMeans</a></span>(mat)</a>
<a class="sourceLine" id="cb22-9" data-line-number="9"></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co"># plot heatmap</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/ComplexHeatmap/topics/Heatmap">Heatmap</a></span>(mat)</a></code></pre></div>
<p><img src="class-4_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="exercises" class="section level2">
<h2 class="hasAnchor">
<a href="#exercises" class="anchor"></a>Exercises</h2>
<p>The exercises for today’s class are presented <a href="https://rnabioco.github.io/pbda/articles/problem-set-3.html">here</a>, Here is a <a href="https://github.com/IDPT7810/practical-data-analysis/blob/master/vignettes/problem-set-3.Rmd">link</a> to the raw text of these exercises</p>
</div>
<div id="quiz" class="section level2">
<h2 class="hasAnchor">
<a href="#quiz" class="anchor"></a>Quiz</h2>
<p>Create an RMarkdown document and answer the questions from the Exercises section. Write your answers in the text, and print the final tibbles/plots that your code produced that gave you the answer. Submit your final document as “Problem Set 3” by <strong>Friday at 10 PM</strong>.</p>
<p><strong>Your submitted document must knit to HTML without errors</strong>. I.e., when you click the “Knit” button, the document should build and display and HTML page.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#rna-seq-analysis-in-r">RNA-seq analysis in R</a><ul class="nav nav-pills nav-stacked">
<li><a href="#before-we-get-started-install-bioconductor-packages-and-update-pbda">Before we get started: Install Bioconductor packages and update pbda</a></li>
      <li><a href="#matrices-in-r-are-two-dimensional-objects-that-contain-elements-of-one-atomic-type">Matrices in R are two dimensional objects that contain elements of one atomic type</a></li>
      <li><a href="#elements-of-a-matrix-can-be-accessed-using-column-and-row-indices-or-names">Elements of a matrix can be accessed using column and row indices or names</a></li>
      <li><a href="#mathematical-operations-can-be-performed-on-numeric-matrices">Mathematical operations can be performed on numeric matrices</a></li>
      </ul>
</li>
      <li>
<a href="#analyzing-rna-seq-data">Analyzing RNA-Seq Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#simplified-rna-sequencing-analysis-workflow-genome-alignment">Simplified RNA sequencing analysis workflow (genome alignment)</a></li>
      <li><a href="#simplified-rna-sequencing-analysis-workflow-quasi-mapping">Simplified RNA sequencing analysis workflow (quasi-mapping)</a></li>
      <li><a href="#inspect-rna-seq-count-and-phenotype-data-from-file-that-is-included-in-pbda-package">Inspect RNA-seq count and phenotype data from file that is included in pbda package</a></li>
      <li><a href="#deseq2-uses-deseqdatasets-a-subset-of-the-bioconductor-summarizedexperiment-object-to-store-data">DESeq2 uses DESeqDataSets, a subset of the Bioconductor SummarizedExperiment object, to store data</a></li>
      <li><a href="#build-a-deseqdataset-from-the-drug_resistant-data-and-inspect-the-object">Build a DESeqDataSet from the drug_resistant data and inspect the object</a></li>
      <li><a href="#filter-genes-with-little-or-no-expression">Filter genes with little or no expression</a></li>
      <li><a href="#stabilize-the-variance-across-the-mean-for-visualizing-count-data">Stabilize the variance across the mean for visualizing count data</a></li>
      <li><a href="#sample-distances-are-useful-to-assess-the-overall-similarity-between-samples">Sample distances are useful to assess the overall similarity between samples</a></li>
      <li><a href="#principle-component-analysis-pca-plots">Principle Component Analysis (PCA) plots</a></li>
      <li><a href="#calculating-differential-expression">Calculating differential expression</a></li>
      <li><a href="#extracting-results-after-differential-expression-is-calculated">Extracting results after differential expression is calculated</a></li>
      <li><a href="#ma-plots">MA-plots</a></li>
      <li><a href="#plotting-differential-expression-results">Plotting differential expression results</a></li>
      <li><a href="#plotting-heatmaps-of-differentially-expressed-genes">Plotting heatmaps of differentially expressed genes</a></li>
      <li><a href="#exercises">Exercises</a></li>
      <li><a href="#quiz">Quiz</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://hesselberthlab.org">Jay Hesselberth</a>, Austin Gillen, Kent Riemondy, Rui Fu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
