<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class 6: Single Cell RNA-seq Analysis â€¢ pbda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Class 6: Single Cell RNA-seq Analysis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pbda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Class Material
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/class-1.html">Class 1: Overview, Data Import and Tidying</a>
    </li>
    <li>
      <a href="../articles/class-2.html">Class 2: Analyzing qPCR data</a>
    </li>
    <li>
      <a href="../articles/class-3.html">Class 3: Exploring a biological data set</a>
    </li>
    <li>
      <a href="../articles/class-4.html">Class 4: RNA-seq Analysis</a>
    </li>
    <li>
      <a href="../articles/class-5.html">Class 5: Gene List Handling</a>
    </li>
    <li>
      <a href="../articles/class-6.html">Class 6: Single Cell RNA-seq</a>
    </li>
    <li>
      <a href="../articles/class-7.html">Class 7: Heatmaps and Clustering</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/assignments.html">Assignment Submission and Grading Rubric</a>
    </li>
    <li>
      <a href="../articles/problem-set-1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="../articles/problem-set-2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="../articles/problem-set-3.html">Problem Set 3</a>
    </li>
    <li>
      <a href="../articles/problem-set-4.html">Problem Set 4</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/IDPT7810/practical-data-analysis">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Class 6: Single Cell RNA-seq Analysis</h1>
                        <h4 class="author">Austin Gillen</h4>
            
            <h4 class="date">2018-12-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/IDPT7810/practical-data-analysis/blob/master/vignettes/class-6.Rmd"><code>vignettes/class-6.Rmd</code></a></small>
      <div class="hidden name"><code>class-6.Rmd</code></div>

    </div>

    
    
<div id="single-cell-rna-seq-analysis-in-r-with-seurat" class="section level1">
<h1 class="hasAnchor">
<a href="#single-cell-rna-seq-analysis-in-r-with-seurat" class="anchor"></a>Single cell RNA-seq analysis in R with Seurat</h1>
<p>(Adapted from the <a href="http://satijalab.org/seurat/pbmc3k_tutorial.html">Seurat PBMC 3k Tutorial</a>)</p>
<ul>
<li>Introduce sparse matrices</li>
<li>QC considerations for scRNA-seq data sets</li>
<li>Build a seurat object, cluster cells and and calculate differential gene expression</li>
</ul>
<div id="before-we-get-started-install-seurat-and-update-pbda" class="section level2">
<h2 class="hasAnchor">
<a href="#before-we-get-started-install-seurat-and-update-pbda" class="anchor"></a>Before we get started: Install Seurat and update pbda</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"Seurat"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"Matrix"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">'idpt7810/practical-data-analysis'</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(pbda)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Seurat)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Matrix)</a></code></pre></div>
</div>
<div id="single-cell-rna-seq-analysis-in-r-starts-with-the-same-data-as-bulk-rna-seq-a-count-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#single-cell-rna-seq-analysis-in-r-starts-with-the-same-data-as-bulk-rna-seq-a-count-matrix" class="anchor"></a>Single cell RNA-seq analysis in R starts with the same data as bulk RNA-seq: a count matrix</h2>
<p>However, for efficiency, scRNA-seq data is stored in sparse matrix objects. An example data set consisting of 2,700 peripheral blood mononuclear cells (PMBCs) is included in the eda package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># load the path to the example data</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">pbmc_10x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"pbmc_gene_bc_matrices"</span>, <span class="st">"hg19"</span>, <span class="dt">package =</span> <span class="st">"pbda"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># read the example data</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">pbmc.data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/Read10X">Read10X</a></span>(pbmc_10x)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># print the size of the sparse matrix</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/object.size">object.size</a></span>(<span class="dt">x =</span> pbmc.data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="dt">units =</span> <span class="st">"auto"</span>)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; [1] "37.2 Mb"</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co"># print the size of the full matrix</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/object.size">object.size</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="dt">x =</span> pbmc.data)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="dt">units =</span> <span class="st">"auto"</span>)</a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; [1] "676.7 Mb"</span></a></code></pre></div>
</div>
<div id="seurat-uses-a-custom-object-to-store-counts-and-data-similar-to-the-summarizedexperiment-deseqdataset" class="section level2">
<h2 class="hasAnchor">
<a href="#seurat-uses-a-custom-object-to-store-counts-and-data-similar-to-the-summarizedexperiment-deseqdataset" class="anchor"></a>Seurat uses a custom object to store counts and data (similar to the SummarizedExperiment &amp; DESeqDataSet)</h2>
<p>First, weâ€™ll generate a Seurat object with the raw count data, keeping all genes that are expressed in at least 3 cells and all cells with at least 200 detectable genes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/CreateSeuratObject">CreateSeuratObject</a></span>(<span class="dt">raw.data =</span> pbmc.data,</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">                           <span class="dt">min.cells =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                           <span class="dt">min.genes =</span> <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                           <span class="dt">project =</span> <span class="st">"10x_PBMC"</span>)</a></code></pre></div>
</div>
<div id="filtering-and-qc-for-scrna-seq" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-and-qc-for-scrna-seq" class="anchor"></a>Filtering and QC for scRNA-seq</h2>
<p>scRNA-seq data sets are further filtered to remove cells with too few detectable genes, cells with clear outlier numbers of detectable genes (likely doublets) and cells with high proportions of mitochondrial RNAs (likely dead cells).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Calculate percent of reads that are mitochondrial</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">mito.genes &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern =</span> <span class="st">"^MT-"</span>,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                   <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(<span class="dt">x =</span> pbmc<span class="op">@</span>data),</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                   <span class="dt">value =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">percent.mito &lt;-<span class="st"> </span>Matrix<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/colSums">colSums</a></span>(pbmc<span class="op">@</span>raw.data[mito.genes, ])<span class="op">/</span>Matrix<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/Matrix/topics/colSums">colSums</a></span>(pbmc<span class="op">@</span>raw.data)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># Add percent.mite as metadata to Seurat object</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/AddMetaData">AddMetaData</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">                    <span class="dt">metadata =</span> percent.mito,</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">                    <span class="dt">col.name =</span> <span class="st">"percent.mito"</span>)</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co"># Plot number of genes, number of UMIs and percent.mito</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/VlnPlot">VlnPlot</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">        <span class="dt">features.plot =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"nGene"</span>, <span class="st">"nUMI"</span>, <span class="st">"percent.mito"</span>),</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">        <span class="dt">nCol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/filtering-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Outliers can be identified visually using the <code>GenePlot</code> function:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/GenePlot">GenePlot</a></span>(<span class="dt">object =</span> pbmc, <span class="dt">gene1 =</span> <span class="st">"nUMI"</span>, <span class="dt">gene2 =</span> <span class="st">"percent.mito"</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/outlier_plot-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/GenePlot">GenePlot</a></span>(<span class="dt">object =</span> pbmc, <span class="dt">gene1 =</span> <span class="st">"nUMI"</span>, <span class="dt">gene2 =</span> <span class="st">"nGene"</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/outlier_plot-2.png" width="576" style="display: block; margin: auto;"></p>
<p>Finally, we can filter the pbmc object with <code>FilterCells</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/FilterCells">FilterCells</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">                    <span class="dt">subset.names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"nGene"</span>, <span class="st">"percent.mito"</span>), </a>
<a class="sourceLine" id="cb7-3" data-line-number="3">                    <span class="dt">low.thresholds =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">200</span>, <span class="op">-</span><span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">                    <span class="dt">high.thresholds =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2500</span>, <span class="fl">0.05</span>))</a></code></pre></div>
</div>
<div id="normalizing-the-data-detecting-variable-genes-and-removing-uninteresting-variation" class="section level2">
<h2 class="hasAnchor">
<a href="#normalizing-the-data-detecting-variable-genes-and-removing-uninteresting-variation" class="anchor"></a>Normalizing the data, detecting variable genes, and removing uninteresting variation</h2>
<p>After filtering, we need to normalize gene expression across cells with the <code>NormalizeData</code> function. This function normalizes gene expression measurements by per-cell total expression, multiplies the result by an arbitrary value (10,000 here) and log transforms the result.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/NormalizeData">NormalizeData</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">                      <span class="dt">normalization.method =</span> <span class="st">"LogNormalize"</span>, </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                      <span class="dt">scale.factor =</span> <span class="dv">10000</span>)</a></code></pre></div>
<p>Next, we identify variable genes using a mean-dispersion plot to mark visual outliers.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/FindVariableGenes">FindVariableGenes</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">                          <span class="dt">mean.function =</span> ExpMean,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                          <span class="dt">dispersion.function =</span> LogVMR, </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                          <span class="dt">x.low.cutoff =</span> <span class="fl">0.0125</span>,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">                          <span class="dt">x.high.cutoff =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">                          <span class="dt">y.cutoff =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/pkg_data-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="dt">x =</span> pbmc<span class="op">@</span>var.genes)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; [1] 1838</span></a></code></pre></div>
<p>Single cell data sets contain various types of â€˜uninterestingâ€™ variation. These can include technical noise, batch effects and confounding biological variation (such as cell cycle stage). We can regress these signals out of the analysis using <code>ScaleData</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/ScaleData">ScaleData</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">                  <span class="dt">vars.to.regress =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"nUMI"</span>, <span class="st">"percent.mito"</span>))</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; Regressing out: nUMI, percent.mito</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; Time Elapsed:  16.8054039478302 secs</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; Scaling data matrix</span></a></code></pre></div>
</div>
<div id="performing-dimensionality-reduction-and-clustering-pca" class="section level2">
<h2 class="hasAnchor">
<a href="#performing-dimensionality-reduction-and-clustering-pca" class="anchor"></a>Performing dimensionality reduction and clustering: PCA</h2>
<p>As in our bulk RNA-seq example, we need a way to project highly multidimensional data onto a 2D plane. PCA alone is insufficient to capture the variation in these data due to the complexity, so weâ€™ll introduce a new method: t-distributed stochastic neighbor embedding (tSNE). A useful interactive tool to help you understand tSNE can be found <a href="https://distill.pub/2016/misread-tsne/">here</a>. First, weâ€™ll calculate the principle components (used by the clustering and tSNE algorithms):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/RunPCA">RunPCA</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">               <span class="dt">pc.genes =</span> pbmc<span class="op">@</span>var.genes,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">               <span class="dt">do.print =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">               <span class="dt">pcs.print =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">               <span class="dt">genes.print =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; [1] "PC1"</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; [1] "CST3"   "TYROBP" "FCN1"   "LST1"   "AIF1"  </span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; [1] "PTPRCAP" "IL32"    "LTB"     "CD2"     "CTSW"   </span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; [1] "PC2"</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt; [1] "CD79A"    "MS4A1"    "HLA-DQA1" "TCL1A"    "HLA-DQB1"</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; [1] "NKG7" "GZMB" "PRF1" "CST7" "GZMA"</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; [1] "PC3"</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; [1] "CYBA"     "HLA-DPA1" "HLA-DPB1" "HLA-DRB1" "CD37"    </span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt; [1] "PF4"   "PPBP"  "SDPR"  "SPARC" "GNG11"</span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="co">#&gt; [1] "PC4"</span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="co">#&gt; [1] "CD79A"    "HLA-DQA1" "CD79B"    "MS4A1"    "HLA-DQB1"</span></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="co">#&gt; [1] "IL32"   "GIMAP7" "AQP3"   "FYB"    "MAL"   </span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30"><span class="co">#&gt; [1] "PC5"</span></a>
<a class="sourceLine" id="cb12-31" data-line-number="31"><span class="co">#&gt; [1] "FCGR3A"        "CTD-2006K23.1" "IFITM3"        "ABI3"         </span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32"><span class="co">#&gt; [5] "CEBPB"        </span></a>
<a class="sourceLine" id="cb12-33" data-line-number="33"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-34" data-line-number="34"><span class="co">#&gt; [1] "FCER1A"  "LGALS2"  "MS4A6A"  "S100A8"  "CLEC10A"</span></a>
<a class="sourceLine" id="cb12-35" data-line-number="35"><span class="co">#&gt; [1] ""</span></a>
<a class="sourceLine" id="cb12-36" data-line-number="36"><span class="co">#&gt; [1] ""</span></a></code></pre></div>
<p>Next, weâ€™ll generate a PCA plot.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/PCAPlot">PCAPlot</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">        <span class="dt">dim.1 =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">        <span class="dt">dim.2 =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/pca_plot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Multiple subpopulations are clearly visible in this plot, but as weâ€™ll see later, there is even more interesting variation present in these data. However, in order to use the clustering and tSNE algorithms, weâ€™ll need to determine how many PCs comprise the â€˜true dimensionalityâ€™ of the data set. One approach is to view a heatmap of the 500 most extreme cells for each principle component.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/PCHeatmap">PCHeatmap</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">          <span class="dt">pc.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">          <span class="dt">cells.use =</span> <span class="dv">500</span>,</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">          <span class="dt">do.balanced =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb14-5" data-line-number="5">          <span class="dt">label.columns =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">          <span class="dt">use.full =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/pca_heatmap-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Another approach is the jackstraw plot, which compares the distribution of p-values for each principle component with a uniform distribution. â€˜Significantâ€™ PCs show an enrichment of genes with low p-values.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/JackStraw">JackStraw</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">                  <span class="dt">num.replicate =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">                  <span class="dt">do.print =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/JackStrawPlot">JackStrawPlot</a></span>(<span class="dt">object =</span> pbmc, <span class="dt">PCs =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)</a></code></pre></div>
<p><img src="img/jackstraw.png"></p>
<p>Finally, we can generate an â€˜elbow plotâ€™ of the standard deviation of the principle components. The â€˜elbowâ€™ indicated the last significant principle component.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/PCElbowPlot">PCElbowPlot</a></span>(<span class="dt">object =</span> pbmc)</a></code></pre></div>
<p><img src="class-6_files/figure-html/elbow_plot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Based on these plots, we conclude that the first 7-10 PCs contain sufficient variation for use downstream.</p>
</div>
<div id="performing-dimensionality-reduction-and-clustering-clustering-and-tsne" class="section level2">
<h2 class="hasAnchor">
<a href="#performing-dimensionality-reduction-and-clustering-clustering-and-tsne" class="anchor"></a>Performing dimensionality reduction and clustering: Clustering and tSNE</h2>
<p>Now that weâ€™ve identified the â€˜true dimensionalityâ€™ of the data, we can cluster the cells and project them on a tSNE plot.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/FindClusters">FindClusters</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                     <span class="dt">reduction.type =</span> <span class="st">"pca"</span>,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                     <span class="dt">dims.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb17-4" data-line-number="4">                     <span class="dt">resolution =</span> <span class="fl">0.6</span>,</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">                     <span class="dt">print.output =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                     <span class="dt">save.SNN =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/RunTSNE">RunTSNE</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">                <span class="dt">dims.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">                <span class="dt">do.fast =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-11" data-line-number="11"></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/TSNEPlot">TSNEPlot</a></span>(<span class="dt">object =</span> pbmc)</a></code></pre></div>
<p><img src="class-6_files/figure-html/find_clusters-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Clustering reveals seven distinct populations that are accurately separated in the tSNE projection - substantially more complexity than was captured in the PCA plot!</p>
</div>
<div id="identifying-marker-genes-differential-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#identifying-marker-genes-differential-expression" class="anchor"></a>Identifying marker genes (differential expression)</h2>
<p>Seurat provides the <code>FindAllMarkers</code> and <code>FindMarkers</code> functions for identifying differentially expressed genes in all clusters vs.Â all other clusters and in specific pairs of clusters, respectively.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">pbmc.markers &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/FindAllMarkers">FindAllMarkers</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">                               <span class="dt">only.pos =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">                               <span class="dt">min.pct =</span> <span class="fl">0.25</span>, </a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                               <span class="dt">thresh.use =</span> <span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">pbmc.markers <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(cluster) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">2</span>, avg_logFC)</a></code></pre></div>
<p>Differentially expressed genes can be visualized as violin plots:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/VlnPlot">VlnPlot</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">        <span class="dt">features.plot =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"LDHB"</span>, <span class="st">"CD79A"</span>))</a></code></pre></div>
<p><img src="class-6_files/figure-html/plot_genes_violin-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Or as â€˜feature plotsâ€™ on the tSNE projection:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/FeaturePlot">FeaturePlot</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">            <span class="dt">features.plot =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MS4A1"</span>,</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">                              <span class="st">"GNLY"</span>,</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">                              <span class="st">"CD3E"</span>,</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">                              <span class="st">"CD14"</span>, </a>
<a class="sourceLine" id="cb20-6" data-line-number="6">                              <span class="st">"FCER1A"</span>,</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">                              <span class="st">"FCGR3A"</span>,</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">                              <span class="st">"LYZ"</span>,</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">                              <span class="st">"PPBP"</span>,</a>
<a class="sourceLine" id="cb20-10" data-line-number="10">                              <span class="st">"CD8A"</span>),</a>
<a class="sourceLine" id="cb20-11" data-line-number="11">            <span class="dt">cols.use =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"grey"</span>, <span class="st">"blue"</span>), </a>
<a class="sourceLine" id="cb20-12" data-line-number="12">            <span class="dt">reduction.use =</span> <span class="st">"tsne"</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/plot_genes_feature-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="manipulating-seurat-objects-renaming-clusters" class="section level2">
<h2 class="hasAnchor">
<a href="#manipulating-seurat-objects-renaming-clusters" class="anchor"></a>Manipulating Seurat objects: renaming clusters</h2>
<p>The marker genes identified above can be used to reclassify clusters as known cell types. This provides a useful example of how metadata is handled in Seurat.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Create a vector of current cluster IDs</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">current.cluster.ids &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co"># Create a vector of new cluster IDs (cell types)</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5">new.cluster.ids &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"CD4 T cells"</span>,</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">                     <span class="st">"CD14+ Monocytes"</span>,</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">                     <span class="st">"B cells"</span>,</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">                     <span class="st">"CD8 T cells"</span>, </a>
<a class="sourceLine" id="cb21-9" data-line-number="9">                     <span class="st">"FCGR3A+ Monocytes"</span>,</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">                     <span class="st">"NK cells"</span>,</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">                     <span class="st">"Dendritic cells"</span>,</a>
<a class="sourceLine" id="cb21-12" data-line-number="12">                     <span class="st">"Megakaryocytes"</span>)</a>
<a class="sourceLine" id="cb21-13" data-line-number="13"></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="co"># Save the cluster numbers as "cluster.id"</span></a>
<a class="sourceLine" id="cb21-15" data-line-number="15">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/StashIdent">StashIdent</a></span>(<span class="dt">object =</span> pbmc, <span class="dt">save.name =</span> <span class="st">"cluster.id"</span>)</a>
<a class="sourceLine" id="cb21-16" data-line-number="16"></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="co"># Use plyr to remap the idents from the current IDs to the new IDs</span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18">pbmc<span class="op">@</span>ident &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/mapvalues">mapvalues</a></span>(<span class="dt">x =</span> pbmc<span class="op">@</span>ident,</a>
<a class="sourceLine" id="cb21-19" data-line-number="19">                              <span class="dt">from =</span> current.cluster.ids,</a>
<a class="sourceLine" id="cb21-20" data-line-number="20">                              <span class="dt">to =</span> new.cluster.ids)</a>
<a class="sourceLine" id="cb21-21" data-line-number="21"></a>
<a class="sourceLine" id="cb21-22" data-line-number="22"><span class="co"># Plot the tSNE with new cluster IDs</span></a>
<a class="sourceLine" id="cb21-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/TSNEPlot">TSNEPlot</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb21-24" data-line-number="24">         <span class="dt">do.label =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb21-25" data-line-number="25">         <span class="dt">pt.size =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/rename_clusters-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co"># Plot the tSNE with old cluster IDs</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/TSNEPlot">TSNEPlot</a></span>(<span class="dt">object =</span> pbmc,</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">         <span class="dt">do.label =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">         <span class="dt">pt.size =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">         <span class="dt">group.by =</span> <span class="st">"cluster.id"</span>)</a></code></pre></div>
<p><img src="class-6_files/figure-html/rename_clusters-2.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="dealing-with-proliferating-cells" class="section level2">
<h2 class="hasAnchor">
<a href="#dealing-with-proliferating-cells" class="anchor"></a>Dealing with proliferating cells</h2>
<p>PBMCs are poor examples for this analysis, but the commands are shown here to demonstrate how other, more complex variables are regressed out of these analyses.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># Inspect the classifying genes</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">cc.genes</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co"># Classify the cells</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/CellCycleScoring">CellCycleScoring</a></span>(pbmc,</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">                         <span class="dt">s.genes =</span> cc.genes<span class="op">$</span>s.genes,</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">                         <span class="dt">g2m.genes =</span> cc.genes<span class="op">$</span>g2m.genes, </a>
<a class="sourceLine" id="cb23-8" data-line-number="8">                         <span class="dt">set.ident =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb23-9" data-line-number="9"></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="co"># view cell cycle scores and phase assignments</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dt">x =</span> pbmc<span class="op">@</span>meta.data)</a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># Cell cycle stage can then be regressed out using `Scale Data`</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/ScaleData">ScaleData</a></span>(pbmc,</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">                  <span class="dt">vars.to.regress =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"S.Score"</span>, <span class="st">"G2M.Score"</span>),</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">                  <span class="dt">display.progress =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5"></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co"># Alternatively, retain cycling vs. stationary information, but regress out differences in phase</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7">pbmc<span class="op">@</span>meta.data<span class="op">$</span>CC.Difference &lt;-<span class="st"> </span>pbmc<span class="op">@</span>meta.data<span class="op">$</span>S.Score <span class="op">-</span><span class="st"> </span>pbmc<span class="op">@</span>meta.data<span class="op">$</span>G2M.Score</a>
<a class="sourceLine" id="cb24-8" data-line-number="8"></a>
<a class="sourceLine" id="cb24-9" data-line-number="9">pbmc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/Seurat/topics/ScaleData">ScaleData</a></span>(pbmc,</a>
<a class="sourceLine" id="cb24-10" data-line-number="10">                  <span class="dt">vars.to.regress =</span> <span class="st">"CC.Difference"</span>,</a>
<a class="sourceLine" id="cb24-11" data-line-number="11">                  <span class="dt">display.progress =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#single-cell-rna-seq-analysis-in-r-with-seurat">Single cell RNA-seq analysis in R with Seurat</a><ul class="nav nav-pills nav-stacked">
<li><a href="#before-we-get-started-install-seurat-and-update-pbda">Before we get started: Install Seurat and update pbda</a></li>
      <li><a href="#single-cell-rna-seq-analysis-in-r-starts-with-the-same-data-as-bulk-rna-seq-a-count-matrix">Single cell RNA-seq analysis in R starts with the same data as bulk RNA-seq: a count matrix</a></li>
      <li><a href="#seurat-uses-a-custom-object-to-store-counts-and-data-similar-to-the-summarizedexperiment-deseqdataset">Seurat uses a custom object to store counts and data (similar to the SummarizedExperiment &amp; DESeqDataSet)</a></li>
      <li><a href="#filtering-and-qc-for-scrna-seq">Filtering and QC for scRNA-seq</a></li>
      <li><a href="#normalizing-the-data-detecting-variable-genes-and-removing-uninteresting-variation">Normalizing the data, detecting variable genes, and removing uninteresting variation</a></li>
      <li><a href="#performing-dimensionality-reduction-and-clustering-pca">Performing dimensionality reduction and clustering: PCA</a></li>
      <li><a href="#performing-dimensionality-reduction-and-clustering-clustering-and-tsne">Performing dimensionality reduction and clustering: Clustering and tSNE</a></li>
      <li><a href="#identifying-marker-genes-differential-expression">Identifying marker genes (differential expression)</a></li>
      <li><a href="#manipulating-seurat-objects-renaming-clusters">Manipulating Seurat objects: renaming clusters</a></li>
      <li><a href="#dealing-with-proliferating-cells">Dealing with proliferating cells</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://hesselberthlab.org">Jay Hesselberth</a>, Austin Gillen, Kent Riemondy, Rui Fu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
