<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class 5: Genomic Interval Analysis part 2 • eda</title>
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Class 5: Genomic Interval Analysis part 2">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-54095998-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-54095998-4');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eda</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Class Material
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/class-1.html">Class 1: Overview and Data Tidying</a>
    </li>
    <li>
      <a href="../articles/class-2.html">Class 2: Writing Reproducible Reports</a>
    </li>
    <li>
      <a href="../articles/class-3.html">Class 3: Common Analysis Challenges</a>
    </li>
    <li>
      <a href="../articles/class-4.html">Class 4: Genomic Interval Analysis part 1</a>
    </li>
    <li>
      <a href="../articles/class-5.html">Class 5: Genomic Interval Analysis part 2</a>
    </li>
    <li>
      <a href="../articles/class-6.html">Class 6: RNA-Seq Analysis part 1</a>
    </li>
    <li>
      <a href="../articles/class-7.html">Class 7: RNA-Seq Analysis part 2</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/exercises-1.html">Exercises 1</a>
    </li>
    <li>
      <a href="../articles/exercises-2.html">Exercises 2</a>
    </li>
    <li>
      <a href="../articles/exercises-3.html">Exercises 3</a>
    </li>
    <li>
      <a href="../articles/exercises-4.html">Exercises 4</a>
    </li>
    <li>
      <a href="../articles/exercises-5.html">Exercises 5</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/assignment-1.html">Weekend Assignment 1</a>
    </li>
    <li>
      <a href="../articles/assignment-2.html">Weekend Assignment 2</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/assignments.html">Assignment Submission and Grading Rubric</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Class 5: Genomic Interval Analysis part 2</h1>
                        <h4 class="author">Jay Hesselberth</h4>
            
            <h4 class="date">2018-11-08</h4>
      
      
      <div class="hidden name"><code>class-5.Rmd</code></div>

    </div>

    
    
<div id="genomic-interval-data-pt-2" class="section level1">
<h1 class="hasAnchor">
<a href="#genomic-interval-data-pt-2" class="anchor"></a>Genomic Interval Data pt.2</h1>
<ul>
<li>Review exercises 3</li>
<li>Generating randomized intervals with <code><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle()</a></code> and <code><a href="http://valr.hesselberthlab.org/reference/bed_random.html">bed_random()</a></code>
</li>
<li>Metagene profiles with multiple samples</li>
<li>Using functions to simplify analysis workflows</li>
<li>Using lists to organize many R objects</li>
</ul>
<div id="generating-random-intervals-using-bed_shuffle-and-bed_random" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-random-intervals-using-bed_shuffle-and-bed_random" class="anchor"></a>Generating random intervals using <code><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle()</a></code> and <code><a href="http://valr.hesselberthlab.org/reference/bed_random.html">bed_random()</a></code>
</h2>
<p>In the weekend assignment you were asked to generate a metagene profile of RNAPolII ChIP-Seq density surrounding the transcription start site (TSS) of human genes. The plot obtained suggested that RNAPolII seems to be enriched near the TSS. One way to strengthen this argument would be to determine what this profile would look like if we randomly placed RNAPolII binding sites around the genome.</p>
<p><code>valr</code> provides two functions for randomzing intervals. <code><a href="http://valr.hesselberthlab.org/reference/bed_random.html">bed_random()</a></code> which generates intervals of a fixed length throughout the genome and <code><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle()</a></code> which shuffles the location of a set of predefined intervals, but maintains each intervals length.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(valr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; ── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; ✔ ggplot2 3.1.0     ✔ purrr   0.2.5</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; ✔ tibble  1.4.2     ✔ dplyr   0.7.7</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; ✔ tidyr   0.8.2     ✔ stringr 1.3.1</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; ✔ readr   1.1.1     ✔ forcats 0.3.0</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">library</span>(eda)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">genome_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"hg19_genome.txt.gz"</span>, <span class="dt">package =</span> <span class="st">"eda"</span>)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">genome &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/read_genome.html">read_genome</a></span>(genome_file)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">bed &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/read_bed.html">read_bed</a></span>(<span class="st">"https://de.cyverse.org/anon-files/iplant/home/kriemo/data/class/polra2_hela_1e6.bg.gz"</span>,</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">                <span class="dt">n_fields =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">bg &lt;-<span class="st"> </span><span class="kw">select</span>(bed, <span class="kw">everything</span>(), <span class="dt">value =</span> name)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">bg &lt;-<span class="st"> </span><span class="kw">mutate</span>(bg, </a>
<a class="sourceLine" id="cb1-21" data-line-number="21">              <span class="dt">value =</span> <span class="kw">as.numeric</span>(value))</a>
<a class="sourceLine" id="cb1-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">random_ivls &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_random.html">bed_random</a></span>(genome)</a>
<a class="sourceLine" id="cb1-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">shuffled_ivls &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle</a></span>(bg, genome)</a></code></pre></div>
</div>
<div id="exercises" class="section level2">
<h2 class="hasAnchor">
<a href="#exercises" class="anchor"></a>Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Generate 100,000 random intervals of 100 bp each. Set the random number generator seed to <code>42</code> Use the <code>genome</code> R object above. Which chromosome has the most intervals?</p></li>
<li><p>Assign the random intervals produced in question 1 to a new object called <code>random_ivls</code>. Shuffle these intervals using <code><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle()</a></code>, and supply a seed set to <code>42</code>. How many intervals are now on <code>chr1</code>? Shuffle the random intervals (<code>random_ivls</code>) again, but set the <code>within</code> argument to <code>TRUE</code>. What effect does this have on the number of intervals per chromosome?</p></li>
<li><p>Use <code><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle()</a></code> to generate a set of shuffled intervals for the RNA-PolII ChIP-Seq bedgraphs. Again set the seed argument to <code>42</code>. Assign the output to an object named <code>shuffled_coverage</code>. Calculate the total number of basepairs covered in the shuffled and the original bed tibbles.</p></li>
</ol>
</div>
<div id="how-to-generate-a-metagene-plot-with-multiple-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-generate-a-metagene-plot-with-multiple-samples" class="anchor"></a>How to generate a metagene plot with multiple samples?</h2>
<p>In the previous exercise we generated a shuffled bedgraph (<code>shuffled_ivls</code>). Using this as our <code>bedgraph</code> file (object <code>bg</code>), we can recompute our metagene to examine the distribution of randomly positioned RNA-PolII. But how would we plot the shuffled and the original ChIP-seq data on the same graph?</p>
<p>Shown below is an example metagene profile computed for 1 bedgraph. Each <code>.win_id</code> corresponds to one <code>bin</code> or <code>window</code> region surrounding the <code>TSS</code>. The first <code>.win_id</code> represents the mean coverage from the region -1000 to -990 for all TSS in the genome. The second <code>.win_id</code> represents regions -990 to -980 and so on.</p>
<p>How would we modify our tibble to be able to plot multiple ChIP-Seq experiments?</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#&gt; # A tibble: 201 x 2</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt;    .win_id total_coverage</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt;  1       1       23.88922</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;  2       2       26.19525</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;  3       3       23.18755</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;  4       4       22.34402</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;  5       5       26.30945</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;  6       6       28.71125</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;  7       7       28.66961</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;  8       8       23.27538</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;  9       9       35.06543</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; 10      10       34.67965</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; # ... with 191 more rows</span></a></code></pre></div>
<p>If we add another column that indicates the experiment, we can <code>facet</code>, or apply an <code>aesthetic</code> based on the experiment.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#&gt; # A tibble: 402 x 3</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt;    .win_id total_coverage experiment</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;  1       1       23.88922          1</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;  2       1       23.88922          2</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;  3       2       26.19525          1</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;  4       2       26.19525          2</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;  5       3       23.18755          1</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;  6       3       23.18755          2</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  7       4       22.34402          1</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  8       4       22.34402          2</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  9       5       26.30945          1</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 10       5       26.30945          2</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; # ... with 392 more rows</span></a></code></pre></div>
</div>
<div id="bind_rows-binds-rows-of-multiple-tibbles-together" class="section level2">
<h2 class="hasAnchor">
<a href="#bind_rows-binds-rows-of-multiple-tibbles-together" class="anchor"></a>bind_rows(), binds rows of multiple tibbles together</h2>
<p>The <code>dplyr</code> function <code>bind_rows()</code> combines multiple tibbles together in a row-wise fashion. <code>bind_cols</code> binds tibbles together column-wise.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">tibble_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">id =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">measurement_1 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>))</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">tibble_<span class="dv">1</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; # A tibble: 100 x 2</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;       id measurement_1</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;    &lt;int&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  1     1        0.0673</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  2     2       -0.235 </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  3     3       -0.434 </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  4     4       -0.0289</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  5     5       -0.687 </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  6     6        0.191 </span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  7     7        0.0707</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;  8     8       -0.277 </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;  9     9       -0.122 </span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; 10    10       -0.499 </span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; # ... with 90 more rows</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"></a>
<a class="sourceLine" id="cb4-20" data-line-number="20">tibble_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">id =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">  <span class="dt">measurement_1 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>))</a>
<a class="sourceLine" id="cb4-22" data-line-number="22">tibble_<span class="dv">2</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; # A tibble: 100 x 2</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt;       id measurement_1</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt;    &lt;int&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt;  1     1        -1.35 </span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt;  2     2        -0.195</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt;  3     3         1.67 </span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt;  4     4         0.317</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt;  5     5        -0.818</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt;  6     6         0.326</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt;  7     7        -0.194</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">#&gt;  8     8         0.140</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt;  9     9         1.19 </span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">#&gt; 10    10         0.182</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">#&gt; # ... with 90 more rows</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="kw">bind_rows</span>(tibble_<span class="dv">1</span>, tibble_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="co">#&gt; # A tibble: 200 x 2</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="co">#&gt;       id measurement_1</span></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="co">#&gt;    &lt;int&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42"><span class="co">#&gt;  1     1        0.0673</span></a>
<a class="sourceLine" id="cb4-43" data-line-number="43"><span class="co">#&gt;  2     2       -0.235 </span></a>
<a class="sourceLine" id="cb4-44" data-line-number="44"><span class="co">#&gt;  3     3       -0.434 </span></a>
<a class="sourceLine" id="cb4-45" data-line-number="45"><span class="co">#&gt;  4     4       -0.0289</span></a>
<a class="sourceLine" id="cb4-46" data-line-number="46"><span class="co">#&gt;  5     5       -0.687 </span></a>
<a class="sourceLine" id="cb4-47" data-line-number="47"><span class="co">#&gt;  6     6        0.191 </span></a>
<a class="sourceLine" id="cb4-48" data-line-number="48"><span class="co">#&gt;  7     7        0.0707</span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49"><span class="co">#&gt;  8     8       -0.277 </span></a>
<a class="sourceLine" id="cb4-50" data-line-number="50"><span class="co">#&gt;  9     9       -0.122 </span></a>
<a class="sourceLine" id="cb4-51" data-line-number="51"><span class="co">#&gt; 10    10       -0.499 </span></a>
<a class="sourceLine" id="cb4-52" data-line-number="52"><span class="co">#&gt; # ... with 190 more rows</span></a>
<a class="sourceLine" id="cb4-53" data-line-number="53"></a>
<a class="sourceLine" id="cb4-54" data-line-number="54"><span class="kw">bind_rows</span>(tibble_<span class="dv">1</span>, tibble_<span class="dv">2</span>, <span class="dt">.id =</span> <span class="st">"tibble_id"</span>)</a>
<a class="sourceLine" id="cb4-55" data-line-number="55"><span class="co">#&gt; # A tibble: 200 x 3</span></a>
<a class="sourceLine" id="cb4-56" data-line-number="56"><span class="co">#&gt;    tibble_id    id measurement_1</span></a>
<a class="sourceLine" id="cb4-57" data-line-number="57"><span class="co">#&gt;    &lt;chr&gt;     &lt;int&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-58" data-line-number="58"><span class="co">#&gt;  1 1             1        0.0673</span></a>
<a class="sourceLine" id="cb4-59" data-line-number="59"><span class="co">#&gt;  2 1             2       -0.235 </span></a>
<a class="sourceLine" id="cb4-60" data-line-number="60"><span class="co">#&gt;  3 1             3       -0.434 </span></a>
<a class="sourceLine" id="cb4-61" data-line-number="61"><span class="co">#&gt;  4 1             4       -0.0289</span></a>
<a class="sourceLine" id="cb4-62" data-line-number="62"><span class="co">#&gt;  5 1             5       -0.687 </span></a>
<a class="sourceLine" id="cb4-63" data-line-number="63"><span class="co">#&gt;  6 1             6        0.191 </span></a>
<a class="sourceLine" id="cb4-64" data-line-number="64"><span class="co">#&gt;  7 1             7        0.0707</span></a>
<a class="sourceLine" id="cb4-65" data-line-number="65"><span class="co">#&gt;  8 1             8       -0.277 </span></a>
<a class="sourceLine" id="cb4-66" data-line-number="66"><span class="co">#&gt;  9 1             9       -0.122 </span></a>
<a class="sourceLine" id="cb4-67" data-line-number="67"><span class="co">#&gt; 10 1            10       -0.499 </span></a>
<a class="sourceLine" id="cb4-68" data-line-number="68"><span class="co">#&gt; # ... with 190 more rows</span></a></code></pre></div>
</div>
<div id="generating-a-metagene-with-multiple-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-a-metagene-with-multiple-samples" class="anchor"></a>Generating a metagene with multiple samples</h2>
<p>First let’s read all of our bed files into <code>R</code></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">genes_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"hg19_genes.bed.gz"</span>, <span class="dt">package =</span> <span class="st">"eda"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">genes &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/read_bed.html">read_bed</a></span>(genes_file, <span class="dt">n_fields =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">genome_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"hg19_genome.txt.gz"</span>, <span class="dt">package =</span> <span class="st">"eda"</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">genome &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/read_genome.html">read_genome</a></span>(genome_file)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">bed &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/read_bed.html">read_bed</a></span>(<span class="st">"https://de.cyverse.org/anon-files/iplant/home/kriemo/data/class/polra2_hela_1e6.bg.gz"</span>,</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">                <span class="dt">n_fields =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">bg &lt;-<span class="st"> </span><span class="kw">select</span>(bed, <span class="kw">everything</span>(), <span class="dt">value =</span> name)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">bg &lt;-<span class="st"> </span><span class="kw">mutate</span>(bg, </a>
<a class="sourceLine" id="cb5-12" data-line-number="12">              <span class="dt">value =</span> <span class="kw">as.numeric</span>(value))</a></code></pre></div>
<p>Then let’s generate our set of windows surrounding each TSS (“+” strand only)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">tss_windows &lt;-<span class="st"> </span>genes <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(strand <span class="op">==</span><span class="st"> "+"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">end =</span> start <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_slop.html">bed_slop</a></span>(genome, <span class="dt">both =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_makewindows.html">bed_makewindows</a></span>(genome, <span class="dt">win_size =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; Warning: genome argument has been deprecated, ignoring</span></a></code></pre></div>
<p>Next, let’s compute coverage for the rnapolII bedgraph.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">rnapolII &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_map.html">bed_map</a></span>(tss_windows, </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">          bg,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">          <span class="dt">total_reads =</span> <span class="kw">sum</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(.win_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total_coverage =</span> <span class="kw">mean</span>(total_reads, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </a></code></pre></div>
<p>Lastly, let’s compute coverage for a shuffled bedgraph.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">shuffled_coverage &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle</a></span>(bg, genome, <span class="dt">seed =</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">shuffled &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_map.html">bed_map</a></span>(tss_windows, </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">          shuffled_coverage,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">          <span class="dt">total_reads =</span> <span class="kw">sum</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(.win_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total_coverage =</span> <span class="kw">mean</span>(total_reads, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">rnapolII</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; # A tibble: 201 x 2</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;    .win_id total_coverage</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  1       1           23.2</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;  2       2           25.3</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;  3       3           22.5</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;  4       4           21.8</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;  5       5           25.7</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt;  6       6           28.0</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt;  7       7           28.1</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt;  8       8           22.7</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt;  9       9           34.3</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; 10      10           33.9</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt; # ... with 191 more rows</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"></a>
<a class="sourceLine" id="cb8-26" data-line-number="26">shuffled</a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt; # A tibble: 201 x 2</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt;    .win_id total_coverage</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt;  1       1           5.22</span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="co">#&gt;  2       2           4.25</span></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="co">#&gt;  3       3           2.86</span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt;  4       4           3.73</span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="co">#&gt;  5       5           4.24</span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="co">#&gt;  6       6           4.58</span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36"><span class="co">#&gt;  7       7           5.72</span></a>
<a class="sourceLine" id="cb8-37" data-line-number="37"><span class="co">#&gt;  8       8           4.44</span></a>
<a class="sourceLine" id="cb8-38" data-line-number="38"><span class="co">#&gt;  9       9           3.56</span></a>
<a class="sourceLine" id="cb8-39" data-line-number="39"><span class="co">#&gt; 10      10           4.23</span></a>
<a class="sourceLine" id="cb8-40" data-line-number="40"><span class="co">#&gt; # ... with 191 more rows</span></a></code></pre></div>
<p>Now we can bind these results together and we are ready to plot:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(rnapolII,</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">          shuffled,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">          <span class="dt">.id =</span> <span class="st">"expt"</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">res</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; # A tibble: 402 x 3</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;    expt  .win_id total_coverage</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;    &lt;chr&gt;   &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt;  1 1           1           23.2</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;  2 1           2           25.3</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;  3 1           3           22.5</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;  4 1           4           21.8</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;  5 1           5           25.7</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;  6 1           6           28.0</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;  7 1           7           28.1</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;  8 1           8           22.7</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;  9 1           9           34.3</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; 10 1          10           33.9</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; # ... with 392 more rows</span></a></code></pre></div>
<p>Add finally plot the results</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">ggplot</span>(res, <span class="kw">aes</span>(.win_id, total_coverage)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> expt))</a></code></pre></div>
<p><img src="img/class-2-unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="writing-a-function-to-produce-a-metagene" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-a-function-to-produce-a-metagene" class="anchor"></a>Writing a function to produce a metagene</h2>
<p>At this point we have generated profiles for the RNAPolII chip and a shuffled control. As you may have noticed, a lot of the code that we wrote was duplicated.</p>
<p>Here’s all of the code used to compute the metagene profile. Imagine that we wanted to now generate additional metagene profiles. We could copy and paste the code below and change it to make a new plot. What parts of the code would we need to change in order to make a metagene for a new bedGraph file?</p>
<pre><code>output &lt;- genes %&gt;% 
  filter(strand == "+") %&gt;% 
  mutate(end = start + 1) %&gt;% 
  bed_slop(genome, both = 1000) %&gt;% 
  bed_makewindows(genome, win_size = 10) %&gt;% 
  bed_map(., 
          bg,
          total_reads = sum(value)) %&gt;% 
  group_by(.win_id) %&gt;%
  summarize(total_coverage = mean(total_reads, na.rm = TRUE)) </code></pre>
<p>As you can see all that we need to change is the input <code>bg</code> object.</p>
</div>
<div id="writing-functions-reduces-repeated-code" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-functions-reduces-repeated-code" class="anchor"></a>Writing functions reduces repeated code</h2>
<p>A common rule in programming is <code>DRY</code> or <strong>D</strong>on’t <strong>R</strong>epeat <strong>Y</strong>ourself. If you need to do something more than twice, then write a function. This reduces the amount of code you have to type, and therefore reduces typos. Additionally, if you need to change something, now you dont have to change it everywhere you copied and pasted the code, but rather just in the function.</p>
</div>
<div id="introduction-to-functions-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-functions-in-r" class="anchor"></a>Introduction to functions in R</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">hello_world &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="kw">print</span>(<span class="st">"hello world"</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw">hello_world</span>()</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; [1] "hello world"</span></a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">add_one_to_one &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">add_one_to_one</span>()</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">add_one &lt;-<span class="st"> </span><span class="cf">function</span>(number_to_add){</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>number_to_add</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb13-11" data-line-number="11"></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="kw">add_one</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; [1] 43</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">int_to_add &lt;-<span class="st"> </span><span class="dv">42</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="kw">add_one</span>(int_to_add)</a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; [1] 43</span></a></code></pre></div>
</div>
<div id="functions-can-have-default-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#functions-can-have-default-arguments" class="anchor"></a>Functions can have default arguments</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">add_any &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">first =</span> <span class="dv">1</span>, <span class="dt">second =</span> <span class="dv">2</span>){</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  res &lt;-<span class="st"> </span>first <span class="op">+</span><span class="st"> </span>second</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  res</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw">add_any</span>()</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="kw">add_any</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; [1] 6</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="kw">add_any</span>(<span class="dv">2</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
</div>
<div id="computing-the-metagene-profile-using-a-function" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-the-metagene-profile-using-a-function" class="anchor"></a>Computing the metagene profile using a function</h2>
<p>When writing a function we need to identify all of the objects that need to be passed to the function. A function should not depend on objects in in the environment (i.e. current session) to run.</p>
<p>For example in the following code, <code>genes</code>, <code>genome</code>, and <code>bg</code> all need to be in the environment for this code to run. Therefore we should make these arguments that are passed to the function.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">output &lt;-<span class="st"> </span>genes <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(strand <span class="op">==</span><span class="st"> "+"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">end =</span> start <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_slop.html">bed_slop</a></span>(genome, <span class="dt">both =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_makewindows.html">bed_makewindows</a></span>(genome, <span class="dt">win_size =</span> <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_map.html">bed_map</a></span>(., </a>
<a class="sourceLine" id="cb15-7" data-line-number="7">          bg,</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">          <span class="dt">total_reads =</span> <span class="kw">sum</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(.win_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total_coverage =</span> <span class="kw">mean</span>(total_reads, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </a></code></pre></div>
<p>Here, we’ve designated the <code>genes</code>, <code>genome</code> and <code>bg</code> objects as function arguments and renamed them to make it clearer what the identity of each argument is.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">compute_metagene &lt;-<span class="st"> </span><span class="cf">function</span>(chip_seq_bedgraph,</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">                                genes_bed,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">                              genome_bed){</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  output &lt;-<span class="st"> </span>genes_bed <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="st">    </span><span class="kw">filter</span>(strand <span class="op">==</span><span class="st"> "+"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">end =</span> start <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="st">    </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_slop.html">bed_slop</a></span>(genome_bed, <span class="dt">both =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_makewindows.html">bed_makewindows</a></span>(genome_bed, <span class="dt">win_size =</span> <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_map.html">bed_map</a></span>(., </a>
<a class="sourceLine" id="cb16-10" data-line-number="10">            chip_seq_bedgraph,</a>
<a class="sourceLine" id="cb16-11" data-line-number="11">            <span class="dt">total_reads =</span> <span class="kw">sum</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="st">    </span><span class="kw">group_by</span>(.win_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_coverage =</span> <span class="kw">mean</span>(total_reads, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </a>
<a class="sourceLine" id="cb16-14" data-line-number="14">  output</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb16-16" data-line-number="16"></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="kw">compute_metagene</span>(bg, genes, genome)</a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; Warning: genome argument has been deprecated, ignoring</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt; # A tibble: 201 x 2</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt;    .win_id total_coverage</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="co">#&gt;  1       1           23.2</span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt;  2       2           25.3</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt;  3       3           22.5</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt;  4       4           21.8</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt;  5       5           25.7</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt;  6       6           28.0</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="co">#&gt;  7       7           28.1</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt;  8       8           22.7</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="co">#&gt;  9       9           34.3</span></a>
<a class="sourceLine" id="cb16-31" data-line-number="31"><span class="co">#&gt; 10      10           33.9</span></a>
<a class="sourceLine" id="cb16-32" data-line-number="32"><span class="co">#&gt; # ... with 191 more rows</span></a></code></pre></div>
<p>Now we can apply the function to any arbitrary bedgraph:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">compute_metagene</span>(shuffled_coverage, genes, genome)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw">compute_metagene</span>(..., genes, genome)</a></code></pre></div>
</div>
<div id="using-lists-to-organize-many-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#using-lists-to-organize-many-objects" class="anchor"></a>Using lists to organize many objects</h2>
<p>Imagine we perform our ChIP-Seq experiment with many replicates. We can use the <code><a href="http://valr.hesselberthlab.org/reference/read_bed.html">read_bed()</a></code> to read all of these files into <code>R</code>, but now we have a whole bunch of <code>R</code> objects in our environment.</p>
<pre><code>bg_chipseq_rep1 &lt;- read_bed("rep1.bg.gz")
bg_chipseq_rep2 &lt;- read_bed("rep2.bg.gz")
bg_chipseq_rep3 &lt;- read_bed("rep3.bg.gz")
bg_chipseq_rep4 &lt;- read_bed("rep4.bg.gz")
bg_chipseq_rep5 &lt;- read_bed("rep5.bg.gz")
bg_chipseq_rep6 &lt;- read_bed("rep6.bg.gz")</code></pre>
<p>You can imagine that we could end up generating many intermediate files, and again repeating ourselves, even though we are using a function.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">metagene_chipseq_rep1 &lt;-<span class="st"> </span><span class="kw">compute_metagene</span>(bg_chipseq_rep1, genome, genes)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">metagene_chipseq_rep2 &lt;-<span class="st"> </span><span class="kw">compute_metagene</span>(bg_chipseq_rep2, genome, genes)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">metagene_chipseq_rep3 &lt;-<span class="st"> </span><span class="kw">compute_metagene</span>(bg_chipseq_rep3, genome, genes)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">metagene_chipseq_rep4 &lt;-<span class="st"> </span><span class="kw">compute_metagene</span>(bg_chipseq_rep4, genome, genes)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">metagene_chipseq_rep5 &lt;-<span class="st"> </span><span class="kw">compute_metagene</span>(bg_chipseq_rep5, genome, genes)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">metagene_chipseq_rep6 &lt;-<span class="st"> </span><span class="kw">compute_metagene</span>(bg_chipseq_rep6, genome, genes)</a></code></pre></div>
</div>
<div id="lists-make-it-easy-to-store-and-organize-many-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#lists-make-it-easy-to-store-and-organize-many-objects" class="anchor"></a>Lists make it easy to store and organize many objects</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">chipseq_bgs &lt;-<span class="st"> </span><span class="kw">list</span>(bg_chipseq_rep1,</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">                    bg_chipseq_rep2,</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">                    bg_chipseq_rep3,</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">                    bg_chipseq_rep4,</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">                    bg_chipseq_rep5,</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">                    bg_chipseq_rep6)</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"></a>
<a class="sourceLine" id="cb20-8" data-line-number="8">chipseq_bgs</a></code></pre></div>
<p>You can access an individual element by index</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">chipseq_bgs[[<span class="dv">1</span>]] <span class="co"># first object</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">chipseq_bgs[[<span class="dv">2</span>]] <span class="co"># second object</span></a></code></pre></div>
<p>Or you can name each element, and access by name using the <code>$</code> symbol</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">chipseq_bgs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">rep1 =</span> bg_chipseq_rep1,</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">                    <span class="dt">rep2 =</span> bg_chipseq_rep2,</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">                    <span class="dt">rep3 =</span> bg_chipseq_rep3,</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">                    <span class="dt">rep4 =</span> bg_chipseq_rep4,</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">                    <span class="dt">rep5 =</span> bg_chipseq_rep5,</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">                    <span class="dt">rep6 =</span> bg_chipseq_rep6)</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">                 </a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co"># access first tibble                    </span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9">chipseq_bgs<span class="op">$</span>rep1 </a>
<a class="sourceLine" id="cb22-10" data-line-number="10"></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co"># print chrom column from first tibble</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12">chipseq_bgs<span class="op">$</span>rep1<span class="op">$</span>chrom</a>
<a class="sourceLine" id="cb22-13" data-line-number="13"></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="kw">select</span>(chipseq_bgs<span class="op">$</span>rep1, chrom)</a></code></pre></div>
<p>Now we can refer to a single list object:</p>
<pre><code>metagenes_chipseq = list()
metagenes_chipseq$rep1 &lt;- compute_metagene(chipseq_bgs$rep1, genome, genes)
metagenes_chipseq$rep2 &lt;- compute_metagene(chipseq_bgs$rep2, genome, genes)
...
metagenes_chipseq$rep6 &lt;- compute_metagene(chipseq_bgs$rep6, genome, genes)</code></pre>
</div>
<div id="the-map-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-map-function" class="anchor"></a>The map function</h2>
<p>The <code>map()</code> function takes a list or vector and applys a function to each element of the list or vector.</p>
<pre><code>map(a_vector, a_function)

my_numbers &lt;- c(1, 2, 3)

add_one

map(my_numbers, add_one)
map(my_numbers, ~add_one(.x))</code></pre>
<p>This is extremely useful, as it allows us to apply a function to any number of R objects. In our toy example, to compute a metagene profile for the six chip-seq experiments, we now only need one line.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">metagenes_chipses &lt;-<span class="st"> </span><span class="kw">map</span>(chipseq_bgs, <span class="op">~</span><span class="kw">compute_metagene</span>(.x, genome, genes))</a></code></pre></div>
<p>Here’s a live example using shuffled bedgraphs for simplicity:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co"># make smaller bg </span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3">small_bg &lt;-<span class="st"> </span><span class="kw">sample_n</span>(bg, <span class="fl">1e5</span>)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">bg1 &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle</a></span>(small_bg, genome)</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">bg2 &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle</a></span>(small_bg, genome)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">bg3 &lt;-<span class="st"> </span><span class="kw"><a href="http://valr.hesselberthlab.org/reference/bed_shuffle.html">bed_shuffle</a></span>(small_bg, genome)</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"></a>
<a class="sourceLine" id="cb26-9" data-line-number="9">bgs &lt;-<span class="st"> </span><span class="kw">list</span>(bg1, </a>
<a class="sourceLine" id="cb26-10" data-line-number="10">            bg2,</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">            bg3)</a>
<a class="sourceLine" id="cb26-12" data-line-number="12">            </a>
<a class="sourceLine" id="cb26-13" data-line-number="13">res &lt;-<span class="st"> </span><span class="kw">map</span>(bgs, <span class="op">~</span><span class="kw">compute_metagene</span>(.x, genes, genome))</a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="co">#&gt; Warning: genome argument has been deprecated, ignoring</span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"></a>
<a class="sourceLine" id="cb26-16" data-line-number="16"><span class="co">#&gt; Warning: genome argument has been deprecated, ignoring</span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17"></a>
<a class="sourceLine" id="cb26-18" data-line-number="18"><span class="co">#&gt; Warning: genome argument has been deprecated, ignoring</span></a>
<a class="sourceLine" id="cb26-19" data-line-number="19">res</a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb26-21" data-line-number="21"><span class="co">#&gt; # A tibble: 201 x 2</span></a>
<a class="sourceLine" id="cb26-22" data-line-number="22"><span class="co">#&gt;    .win_id total_coverage</span></a>
<a class="sourceLine" id="cb26-23" data-line-number="23"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">#&gt;  1       1          0.860</span></a>
<a class="sourceLine" id="cb26-25" data-line-number="25"><span class="co">#&gt;  2       2          1.66 </span></a>
<a class="sourceLine" id="cb26-26" data-line-number="26"><span class="co">#&gt;  3       3          1.63 </span></a>
<a class="sourceLine" id="cb26-27" data-line-number="27"><span class="co">#&gt;  4       4          1.62 </span></a>
<a class="sourceLine" id="cb26-28" data-line-number="28"><span class="co">#&gt;  5       5          1.33 </span></a>
<a class="sourceLine" id="cb26-29" data-line-number="29"><span class="co">#&gt;  6       6         35.3  </span></a>
<a class="sourceLine" id="cb26-30" data-line-number="30"><span class="co">#&gt;  7       7          2.92 </span></a>
<a class="sourceLine" id="cb26-31" data-line-number="31"><span class="co">#&gt;  8       8          1.82 </span></a>
<a class="sourceLine" id="cb26-32" data-line-number="32"><span class="co">#&gt;  9       9          7.73 </span></a>
<a class="sourceLine" id="cb26-33" data-line-number="33"><span class="co">#&gt; 10      10          6.34 </span></a>
<a class="sourceLine" id="cb26-34" data-line-number="34"><span class="co">#&gt; # ... with 191 more rows</span></a>
<a class="sourceLine" id="cb26-35" data-line-number="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-36" data-line-number="36"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb26-37" data-line-number="37"><span class="co">#&gt; # A tibble: 201 x 2</span></a>
<a class="sourceLine" id="cb26-38" data-line-number="38"><span class="co">#&gt;    .win_id total_coverage</span></a>
<a class="sourceLine" id="cb26-39" data-line-number="39"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb26-40" data-line-number="40"><span class="co">#&gt;  1       1          3.88 </span></a>
<a class="sourceLine" id="cb26-41" data-line-number="41"><span class="co">#&gt;  2       2          4.14 </span></a>
<a class="sourceLine" id="cb26-42" data-line-number="42"><span class="co">#&gt;  3       3          0.910</span></a>
<a class="sourceLine" id="cb26-43" data-line-number="43"><span class="co">#&gt;  4       4          4.30 </span></a>
<a class="sourceLine" id="cb26-44" data-line-number="44"><span class="co">#&gt;  5       5          4.68 </span></a>
<a class="sourceLine" id="cb26-45" data-line-number="45"><span class="co">#&gt;  6       6          8.23 </span></a>
<a class="sourceLine" id="cb26-46" data-line-number="46"><span class="co">#&gt;  7       7          0.831</span></a>
<a class="sourceLine" id="cb26-47" data-line-number="47"><span class="co">#&gt;  8       8          6.34 </span></a>
<a class="sourceLine" id="cb26-48" data-line-number="48"><span class="co">#&gt;  9       9          0.547</span></a>
<a class="sourceLine" id="cb26-49" data-line-number="49"><span class="co">#&gt; 10      10          1.13 </span></a>
<a class="sourceLine" id="cb26-50" data-line-number="50"><span class="co">#&gt; # ... with 191 more rows</span></a>
<a class="sourceLine" id="cb26-51" data-line-number="51"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-52" data-line-number="52"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb26-53" data-line-number="53"><span class="co">#&gt; # A tibble: 201 x 2</span></a>
<a class="sourceLine" id="cb26-54" data-line-number="54"><span class="co">#&gt;    .win_id total_coverage</span></a>
<a class="sourceLine" id="cb26-55" data-line-number="55"><span class="co">#&gt;      &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb26-56" data-line-number="56"><span class="co">#&gt;  1       1          4.53 </span></a>
<a class="sourceLine" id="cb26-57" data-line-number="57"><span class="co">#&gt;  2       2          0.768</span></a>
<a class="sourceLine" id="cb26-58" data-line-number="58"><span class="co">#&gt;  3       3          3.70 </span></a>
<a class="sourceLine" id="cb26-59" data-line-number="59"><span class="co">#&gt;  4       4          2.13 </span></a>
<a class="sourceLine" id="cb26-60" data-line-number="60"><span class="co">#&gt;  5       5          3.90 </span></a>
<a class="sourceLine" id="cb26-61" data-line-number="61"><span class="co">#&gt;  6       6          1.76 </span></a>
<a class="sourceLine" id="cb26-62" data-line-number="62"><span class="co">#&gt;  7       7          1.39 </span></a>
<a class="sourceLine" id="cb26-63" data-line-number="63"><span class="co">#&gt;  8       8          6.47 </span></a>
<a class="sourceLine" id="cb26-64" data-line-number="64"><span class="co">#&gt;  9       9          3.74 </span></a>
<a class="sourceLine" id="cb26-65" data-line-number="65"><span class="co">#&gt; 10      10          4.43 </span></a>
<a class="sourceLine" id="cb26-66" data-line-number="66"><span class="co">#&gt; # ... with 191 more rows</span></a></code></pre></div>
</div>
<div id="combining-many-tibbles" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-many-tibbles" class="anchor"></a>Combining many tibbles</h2>
<p><code>bind_rows()</code> can bind any number of tibbles if the tibbles are supplied as a <code>list()</code>. This is very useful to combining many dataframes that are in a list into a format for plotting.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">all_res &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(res, <span class="dt">.id =</span> <span class="st">"expt"</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">all_res</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">#&gt; # A tibble: 603 x 3</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt;    expt  .win_id total_coverage</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt;   &lt;int&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#&gt;  1 1           1          0.860</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt;  2 1           2          1.66 </span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#&gt;  3 1           3          1.63 </span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#&gt;  4 1           4          1.62 </span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt;  5 1           5          1.33 </span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#&gt;  6 1           6         35.3  </span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="co">#&gt;  7 1           7          2.92 </span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="co">#&gt;  8 1           8          1.82 </span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="co">#&gt;  9 1           9          7.73 </span></a>
<a class="sourceLine" id="cb27-15" data-line-number="15"><span class="co">#&gt; 10 1          10          6.34 </span></a>
<a class="sourceLine" id="cb27-16" data-line-number="16"><span class="co">#&gt; # ... with 593 more rows</span></a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">ggplot</span>(all_res, <span class="kw">aes</span>(.win_id, total_coverage)) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> expt))</a></code></pre></div>
<p><img src="img/class-2-plot_random-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="exercises-1" class="section level2">
<h2 class="hasAnchor">
<a href="#exercises-1" class="anchor"></a>Exercises</h2>
<p>The exercises for today’s class are presented <a href="https://rnabioco.github.io/eda/articles/exercises-4.html">here</a>, Here is a <a href="https://raw.githubusercontent.com/rnabioco/eda/master/vignettes/exercises-4.Rmd">link</a> to the raw text of these exercises</p>
</div>
<div id="quiz" class="section level2">
<h2 class="hasAnchor">
<a href="#quiz" class="anchor"></a>Quiz</h2>
<p>Create an RMarkdown document and answer the questions from the Exercises section. Write your answers in the text, and print the final tibbles that your code produced that gave you the answer. Submit your final document as “Quiz 4” by <strong>Tuesday at 10 PM</strong>.</p>
<p><strong>Your submitted document must knit to HTML without errors</strong>. I.e., when you click the “Knit” button, the document should build and display and HTML page.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#genomic-interval-data-pt-2">Genomic Interval Data pt.2</a><ul class="nav nav-pills nav-stacked">
<li><a href="#generating-random-intervals-using-bed_shuffle-and-bed_random">Generating random intervals using <code><a href="http://valr-hesselberthlab-org/reference/bed_shuffle-html">bed_shuffle()</a></code> and <code><a href="http://valr-hesselberthlab-org/reference/bed_random-html">bed_random()</a></code></a></li>
      <li><a href="#exercises">Exercises</a></li>
      <li><a href="#how-to-generate-a-metagene-plot-with-multiple-samples">How to generate a metagene plot with multiple samples?</a></li>
      <li><a href="#bind_rows-binds-rows-of-multiple-tibbles-together">bind_rows(), binds rows of multiple tibbles together</a></li>
      <li><a href="#generating-a-metagene-with-multiple-samples">Generating a metagene with multiple samples</a></li>
      <li><a href="#writing-a-function-to-produce-a-metagene">Writing a function to produce a metagene</a></li>
      <li><a href="#writing-functions-reduces-repeated-code">Writing functions reduces repeated code</a></li>
      <li><a href="#introduction-to-functions-in-r">Introduction to functions in R</a></li>
      <li><a href="#functions-can-have-default-arguments">Functions can have default arguments</a></li>
      <li><a href="#computing-the-metagene-profile-using-a-function">Computing the metagene profile using a function</a></li>
      <li><a href="#using-lists-to-organize-many-objects">Using lists to organize many objects</a></li>
      <li><a href="#lists-make-it-easy-to-store-and-organize-many-objects">Lists make it easy to store and organize many objects</a></li>
      <li><a href="#the-map-function">The map function</a></li>
      <li><a href="#combining-many-tibbles">Combining many tibbles</a></li>
      <li><a href="#exercises-1">Exercises</a></li>
      <li><a href="#quiz">Quiz</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://hesselberthlab.org">Jay Hesselberth</a>, Austin Gillen, Kent Riemondy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
